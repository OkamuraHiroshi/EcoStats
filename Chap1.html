<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
</head>
 
<body>

## 1 - 2 確率と統計量

whale <- c(20,0,5,10,15)   #  whaleは5個の要素を持つベクトルとする

sum(whale)/length(whale)   #  whaleデータの平均値を計算．mean(whale)としても良い

whale2 <- c(20,0,5,10,1500)    #  whaleデータの最後の要素を100倍して1500にした

c(median(whale), median(whale2))    # whaleとwhale2の中央値を計算．平均なら大きく変わるが，中央値だと同じ

c(var(whale), var(whale2))    # whaleとwhale2の分散を比較

c(sd(whale), sd(whale2))    # whaleとwhale2の標準偏差を比較

( se <- c(sd(whale), sd(whale2))/sqrt(length(whale)) )    # whaleとwhale2の標準誤差を比較（代入式を丸括弧で囲めば，代入と同時に結果を表示する）

mu <- c(mean(whale), mean(whale2))   #  whaleとwhale2の平均値
( cv <- se/mu )    #  whaleとwhale2の平均の変動係数を比較

## 1 - 3 共分散と相関

library(MASS)     # MASSパッケージを使用可能にする
data(cats)     # MASSパッケージの中のcatsデータを読み込む．?catsでデータの中身を確認
dat <- cats    # catsデータをdatの中にコピーする（後で整形することを考えて．元のデータcatsはそのまま残して，datをいろいろ操作する）
plot(dat$Bwt, dat$Hwt, xlab="Body Weight", ylab="Heart Weight")    # x軸にBwt（体重量），y軸にHwt（心臓重量）として散布図を描画．軸のラベルを指定
cov(dat$Bwt, dat$Hwt)    #  BwtとHwtの共分散を計算

set.seed(1)     #  乱数発生のseedを設定．同じ結果の再現ができるようにするため
perm <- sample(nrow(dat))     # datの行数の数字をランダムに並べ替える
plot(dat$Bwt[perm], dat$Hwt, xlab="Body Weight", ylab="Heart Weight")    # 並べ替えたBwtとHwtをプロット
cov(dat$Bwt[perm], dat$Hwt)    # 並べ替えた場合の共分散（上と比較する）

cor(dat$Bwt, dat$Hwt)      # 元データの相関係数（cov(dat$Bwt/10, dat$Hwt/10）とした場合と，cor(dat$Bwt/10, dat$Hwt/10)で結果はどう異なるか比較してみよう
cor(dat$Bwt[perm], dat$Hwt)     # 並べ替えデータの相関係数

x <- seq(0,1,by=0.1)     # x軸の値 0から1まで0.1刻みで
y <- x*(1-x)    # yはxの二次式
plot(x, y, col="blue", pch=16)    # xとyをプロット
cor(x, y)    # xとyには明らかな関係があるが，直線関係ではないので相関は小さいという例（つまり，独立 -> 相関=0は成り立つが，相関=0 -> 独立は成り立たない）

( Sigma <- cov(cbind(dat$Bwt, dat$Hwt)) )   # BwtとHwtの分散共分散行列を評価

## 1 - 4 デルタ法

c(sd(log(dat$Hwt)), sd(dat$Hwt)/mean(dat$Hwt))    # 対数変換したHwtの標準偏差と変動係数はほぼ同じ値になる

D_f <- c(-1/mean(dat$Bwt), 1/mean(dat$Hwt))    # 対数差の値の偏微分（対数の微分は逆関数）
sigmasq_logHperB <- t(D_f)%*%Sigma%*%D_f     # 元の分散共分散行列に両側から偏微分を掛けてデルタ法による分散を評価
( sigma_logHperB <- sqrt(sigmasq_logHperB) )    # デルタ法による分散の平方根で標準誤差を計算
sd(log(dat$Hwt/dat$Bwt))    # 対数差の標準偏差を計算してデルタ法による近似計算がうまくいっているかどうか確認

## 1 - 5 条件付確率とベイズの定理

mat <- matrix(c(58,43,41,46,25,44), nrow=2, ncol=3)    # 性成熟に関する行列形式のデータ例
rownames(mat) <- c("immature","mature")      # 行のラベル
colnames(mat) <- c("1990-1999","2000-2009","2010-2019")       # 列のラベル

pmat <- mat/sum(mat)       # 全数で割って相対値を計算
print(mat)        # 絶対数の表示
print(round(pmat, 2))        # 相対値を表示（小数点以下2桁まで）

pmat_r <- rowSums(pmat)
pmat_c <- colSums(pmat)
c(pmat[1,1]/pmat_r[1], mat[1,1]/sum(mat[1,]))  # 未成熟だった場合の1990年代の割合
c(pmat[1,1]/pmat_c[1], mat[1,1]/sum(mat[,1]))  # 1990年代の未成熟の割合

p_imat <- sapply(1:3, function(i) pmat[1,i]/colSums(pmat)[i])
prior <- c(1/3,1/3,1/3)
( post_bayes <- p_imat*prior/sum(p_imat*prior) )

## 1 - 6 ブートストラップとシミュレーション



</body>
</html>